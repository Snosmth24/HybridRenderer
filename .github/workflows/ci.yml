name: CI/CD

on: [push, pull_request]

jobs:
  unit-tests:
    name: Unit Tests (${{ matrix.os }})
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest]
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      # No submodules needed!
    
    - name: Verify dependencies
      run: |
        if [ ! -f "external/glfw/CMakeLists.txt" ]; then
          echo "ERROR: GLFW not found"
          exit 1
        fi
        if [ ! -f "external/googletest/CMakeLists.txt" ]; then
          echo "ERROR: GoogleTest not found"
          exit 1
        fi
        echo "âœ“ All dependencies present"
      shell: bash
    
    - name: Setup CMake
      uses: lukka/get-cmake@latest
    
    - name: Configure
      run: cmake -B build -DCMAKE_BUILD_TYPE=Debug
    
    - name: Build Unit Tests
      run: cmake --build build --config Debug --target HybridRenderer_unit_tests
    
    - name: Run Tests
      run: |
        cd build
        if [ "${{ runner.os }}" == "Windows" ]; then
          ./bin/Debug/HybridRenderer_unit_tests.exe
        else
          ./bin/Debug/HybridRenderer_unit_tests
        fi
      shell: bash